(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4ec1b5aa"],{"16a0":function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"app-container layout"},[r("el-form",{ref:"form",staticClass:"s-form",attrs:{rules:t.rules,model:t.formData,"label-suffix":":","label-width":"120px"}},[r("el-form-item",{attrs:{label:"编号",prop:"code"}},[r("el-input",{staticStyle:{width:"30%"},attrs:{size:"small"},model:{value:t.formData.code,callback:function(e){t.$set(t.formData,"code",e)},expression:"formData.code"}})],1),r("el-form-item",{attrs:{label:"姓名",prop:"name"}},[r("el-input",{staticStyle:{width:"30%"},attrs:{size:"small"},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1),r("el-form-item",{attrs:{label:"头像",prop:"avatar"}},[r("div",{staticClass:"headPhoto"},[r("div",{staticClass:"headPhoto-ctrl"},[r("img",{attrs:{src:a("d617")},on:{click:t.importAvatar}})]),r("img",{directives:[{name:"show",rawName:"v-show",value:0==t.uploadFileWay,expression:"uploadFileWay == 0"}],staticClass:"headPhoto-mask",staticStyle:{display:"block"},attrs:{src:t._f("fmtAvatar")(t.formData.avatar),width:"100%",height:"100%"}}),r("img",{directives:[{name:"show",rawName:"v-show",value:1==t.uploadFileWay,expression:"uploadFileWay == 1"}],staticClass:"headPhoto-mask",staticStyle:{display:"block"},attrs:{src:t.formData.avatar,width:"100%",height:"100%"}})])]),r("el-form-item",{attrs:{label:"性别",prop:"sex"}},[r("el-radio-group",{model:{value:t.formData.sex,callback:function(e){t.$set(t.formData,"sex",e)},expression:"formData.sex"}},[r("el-radio",{attrs:{label:0}},[t._v("男")]),r("el-radio",{attrs:{label:1}},[t._v("女")])],1)],1),r("el-form-item",{attrs:{label:"所属机构",prop:"orgId"}},[r("treeselect",{staticClass:"g-treeselect",staticStyle:{width:"30%"},attrs:{multiple:!1,options:t.orgData,"disable-branch-nodes":!1,"search-nested":"",placeholder:"请选择"},model:{value:t.formData.orgId,callback:function(e){t.$set(t.formData,"orgId",e)},expression:"formData.orgId"}})],1),r("el-form-item",{attrs:{label:"岗位"}},[r("el-select",{staticStyle:{width:"30%"},attrs:{size:"medium",placeholder:"请选择",clearable:""},model:{value:t.formData.postId,callback:function(e){t.$set(t.formData,"postId",e)},expression:"formData.postId"}},t._l(t.postData,(function(t){return r("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),r("el-form-item",{attrs:{label:"备注"}},[r("el-input",{staticStyle:{width:"30%"},attrs:{type:"textarea",rows:4},model:{value:t.formData.remark,callback:function(e){t.$set(t.formData,"remark",e)},expression:"formData.remark"}})],1),r("el-form-item",[r("div",{staticClass:"dialog-footer"},[r("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.onSubmit}},[t._v("保存")]),r("el-button",{attrs:{size:"small"},on:{click:t.onCancel}},[t._v("取消")])],1)])],1),r("el-dialog",{attrs:{title:"选择头像",visible:t.headPhotoModal,width:"680px"},on:{"update:visible":function(e){t.headPhotoModal=e}}},[r("div",{staticClass:"headPhoto-container"},[r("div",{staticClass:"video-container"},[r("canvas",{attrs:{id:"video-canvas"}})])]),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:t.cancelAvatar}},[t._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:t.handleCapture}},[t._v("抓 拍")])],1)])],1)},o=[],n=a("7b0b"),i=a("33ed"),s=(a("6e9f"),a("7ec7"),a("87da"),a("149f"),a("c662")),l=a("24fd"),c=a("5892"),u=a("3de1"),d=a("7d66"),f=a.n(d),p=(a("5166"),{data:function(){var t=this,e=function(){var e=Object(i["a"])(Object(n["a"])().mark((function e(a,r,o){var i;return Object(n["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,u["a"].verifyCode({code:r,id:t.formData.id});case 2:i=e.sent,null!=i?o(new Error(i)):o();case 4:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}();return{params:this.$route.params,formData:{id:"",name:"",code:"",sex:0,orgId:null,postId:null,remark:"",avatar:""},oldAvatar:null,orgData:[],postData:[],headPhotos:[],headPhotoModal:!1,curAvatarId:null,uploadFileWay:0,fileObj:null,player:null,wsUrl:"ws://127.0.0.1:8089/",rules:{code:[{required:!0,validator:e,trigger:"blur"}],name:[{required:!1,validator:u["a"].verifyPersonName,trigger:"blur"}],avatar:[{required:!0,message:"头像图片不能为空",trigger:"blur"}],sex:[{required:!0,message:"性别不能为空",trigger:"blur"}],orgId:[{required:!0,message:"所属机构不能为空，如改人员不属于任何机构，请选择 '其他'",trigger:"blur"}]},ifUpdateAvatar:!1}},computed:{},created:function(){this.initData(),this.getOrgTree(),this.getPostData()},mounted:function(){},methods:{getOrgTree:function(){var t=this;l["a"].GetOrgs(null,(function(e,a){e||(t.orgData=a.data)}))},getPostData:function(){var t=this;c["a"].GetAllPosts(null,(function(e,a){e||(t.postData=a.data)}))},initData:function(){var t=this;s["a"].GetPersonDetail(this.params.id,(function(e,a){e||(t.formData=a.data,t.oldAvatar=t.formData.avatar)}))},openPhotoModal:function(){var t=this;this.headPhotoModal=!0,this.$nextTick((function(){var e=document.getElementById("video-canvas");e&&(t.player=new JSMpeg.Player(t.wsUrl,{canvas:e}))}))},fileUpload:function(t){var e=document.createElement("input");e.type="file",e.accept="image/gif,image/jpeg,image/jpg,image/png",e.click(),e.onchange=function(a){"function"===typeof t&&t(a.target.files[0]),e=null}},importAvatar:function(){var t=this;t.fileUpload((function(e){var a=new FileReader;a.readAsDataURL(e),a.onload=function(a){t.uploadFileWay=1,t.formData.avatar=this.result,t.fileObj=e,t.ifUpdateAvatar=!0}}))},handleCapture:function(){var t=this;this.player&&this.player.stop(),s["a"].Capture(null,(function(e,a){e||(t.formData.avatar="".concat(a.imgUrl),t.uploadFileWay=0,t.headPhotoModal=!1,t.ifUpdateAvatar=!0)}))},cancelAvatar:function(){this.curAvatarId=null,this.headPhotoModal=!1,this.player&&this.player.stop()},onSubmit:function(){var t=this;this.$refs["form"].validate((function(e){if(!e)return!1;new Promise((function(e,a){if(!t.ifUpdateAvatar)return e(t.formData.avatar);u["a"].uploadAvatar(t.fileObj,{code:t.formData.code}).then((function(t){e(t||null)}))})).then((function(e){e&&(""==t.formData.name&&(t.formData.name=t.formData.code),s["a"].UpdatePerson(Object.assign({},t.formData,{avatar:e,oldAvatar:t.oldAvatar,ifUpdateAvatar:t.ifUpdateAvatar}),(function(e,a){e||(1==a.status?t.$message.error("人脸注册失败，请重新上传人脸图片！"):(t.$message({message:"保存成功!",type:"success"}),t.setRouter()))})))}))}))},onCancel:function(){this.setRouter()},setRouter:function(){this.$router.push({name:"PersonList"})}},beforeDestroy:function(){this.player&&this.player.destroy()},components:{Treeselect:f.a}}),m=p,v=(a("3488"),a("e607")),h=Object(v["a"])(m,r,o,!1,null,"49745704",null);e["default"]=h.exports},"24fd":function(t,e,a){"use strict";var r=a("4876");e["a"]={GetOrgs:function(t,e){Object(r["b"])("/orgs",t,e)},AddOrg:function(t,e){Object(r["d"])("/orgs",t,e)},UpdateOrg:function(t,e){Object(r["e"])("/orgs",t,e)},DeleteOrg:function(t,e){Object(r["a"])("/orgs/"+t,null,e)},GetContrastTree:function(t,e){Object(r["b"])("/contrasttree",t,e)}}},"26ad":function(t,e,a){},3488:function(t,e,a){"use strict";a("26ad")},"3de1":function(t,e,a){"use strict";var r=a("7b0b"),o=a("33ed"),n=(a("7ec7"),a("3016"),a("4fda"),a("f959"),a("535d"),a("938d"),a("220f"),a("0512"),a("1870"),a("87da"),a("6e9f"),a("f753")),i=a.n(n),s=a("4876"),l=a("23c5"),c=function(t,e){var a=e.code,r=e.oldAvatar,o=void 0===r?null:r,n="http://localhost:7068/api/v1";return new Promise((function(e,r){if(t.size>=1048576)return Object(l["Message"])({message:"图片大小不能超过1M!",type:"error",duration:3e3}),void e(null);var s=new FormData;s.append("code",a),s.append("oldAvatar",o),s.append("file",t),i.a.post(n+"/uploadavatar",s).then((function(t){var a=t.data;0==a.code&&a.data?e(a.data.url):e(null)}),(function(t){Object(l["Message"])({message:"图片上传失败！",type:"error",duration:3e3}),e(null)})).catch((function(t){console.error(t),Object(l["Message"])({message:"图片上传失败！",type:"error",duration:3e3}),e(null)}))}))},u=function(t){var e="http://localhost:7068/api/v1";return new Promise((function(a,r){if(t.size>=10485760)return l["Message"].error({content:"视频大小不能超过10M!",duration:3}),void a(null);var o=new FormData;o.append("file",t),i.a.post(e+"/uploadvideo",o).then((function(t){var e=t.data;0==e.code&&e.data?a(e.data.url):a(null)}),(function(t){l["Message"].error({content:"视频上传失败！",duration:3}),a(null)})).catch((function(t){console.error(t),l["Message"].error({content:"视频上传失败！",duration:3}),a(null)}))}))};function d(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"报表",r=arguments.length>3?arguments[3]:void 0;if(t=t.indexOf("http")>-1?t:window.location.origin+t,t=new URL(t),Object.keys(e).forEach((function(a){return t.searchParams.append(a,e[a])})),a){var o=function(t){var e=document.createElement("a");e.style.display="none",e.download=a,e.href=t,document.body.appendChild(e),e.click(),document.body.removeChild(e),window.URL.revokeObjectURL(t),r&&r()};fetch(t,{method:"GET",headers:new Headers({"X-Token":""})}).then((function(t){return t.blob()})).then((function(t){var e=window.URL.createObjectURL(t);o(e)}))}else Object(l["Message"])({message:"没有文件名称！（请联系管理员）",type:"error",duration:5e3})}var f=function(t){var e="http://localhost:7068/api/v1";return new Promise((function(a,r){if(t.size>=1048576)return Object(l["Message"])({message:"图片大小不能超过1M!",type:"error",duration:3e3}),void a(null);var o=new FormData;o.append("file",t),i.a.post(e+"/sysconfig/uploadlicensefile",o).then((function(t){var e=t.data;0==e.code?a(!0):a(e.msg)}),(function(t){Object(l["Message"])({message:"授权文件导入失败！",type:"error",duration:3e3}),a(null)})).catch((function(t){console.error(t),Object(l["Message"])({message:"授权文件导入失败！",type:"error",duration:3e3}),a(null)}))}))},p=function(t){return new Promise((function(e,a){var r=t.code;""==r?e("编号不能为空！"):r.length>100&&e("编号的长度不能超过100！");var o=/^[0-9a-zA-Z_]{1,}$/g;o.test(r)||e("编号为数字，字母，下划线的组合！"),Object(s["b"])("/verify",t,(function(t,a){e(t||null==a?null:a)}))}))},m=function(t){return new Promise((function(e,a){var r=t.name;""!=r&&r.length>100?e("姓名长度不能超过100！"):e(null)}))},v=function(){var t=Object(o["a"])(Object(r["a"])().mark((function t(e,a,o){var n;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,m({name:a});case 2:n=t.sent,null!=n?o(new Error(n)):o();case 4:case"end":return t.stop()}}),t)})));return function(e,a,r){return t.apply(this,arguments)}}(),h=function(){var t=Object(o["a"])(Object(r["a"])().mark((function t(e,a,o){var n;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,p({code:a});case 2:n=t.sent,null!=n?o(new Error(n)):o();case 4:case"end":return t.stop()}}),t)})));return function(e,a,r){return t.apply(this,arguments)}}();e["a"]={downloadFile:d,uploadAvatar:c,uploadVideo:u,uploadLicenseFile:f,verifyCode:p,verifyName:m,verifyPersonCode:h,verifyPersonName:v}},5892:function(t,e,a){"use strict";var r=a("4876");e["a"]={GetList:function(t,e){Object(r["b"])("/posts",t,e)},GetAllPosts:function(t,e){Object(r["b"])("/allposts",t,e)},GetPostDetail:function(t,e){Object(r["b"])("/posts/"+t,null,e)},AddPost:function(t,e){Object(r["d"])("/posts",t,e)},UpdatePost:function(t,e){Object(r["e"])("/posts",t,e)},UpdatePostEnabled:function(t,e){Object(r["e"])("/postenabled",t,e)},DeletePost:function(t,e){Object(r["a"])("/posts/"+t,null,e)}}},c662:function(t,e,a){"use strict";var r=a("4876");e["a"]={GetList:function(t,e){Object(r["b"])("/persons",t,e)},GetPersonDetail:function(t,e){Object(r["b"])("/persons/"+t,null,e)},AddPerson:function(t,e){Object(r["d"])("/persons",t,e)},UpdatePerson:function(t,e){Object(r["e"])("/persons",t,e)},DeletePerson:function(t,e){Object(r["a"])("/persons/"+t,null,e)},PersonContrast:function(t,e){Object(r["b"])("/contrast",t,e)},Capture:function(t,e){Object(r["b"])("/capture",t,e)},GenAvatar:function(t,e){Object(r["b"])("/copyavatar",t,e)},WriteAvatar:function(t,e){Object(r["d"])("/writeavatar",t,e)}}},d617:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAWBJREFUWEft17EuBFEYxfH/eQAPoNMrFF6ASqUkGkFDRbVqehQShURBSAgqiUJHTyGewSvoJEfu5s5mTXZnZ+6MbLC322T2O7+9X+beb8WQl+rk254APiW9p9ZJBtheAG5i8KKk2xREEiAXnuUmISoD+oQnIyoBcuH7QCsm7wHbKe0oDciFH0natO0QKkm2D4GtqohSgFz4iaT1ENQNiJ+PgY0qiIEA23PAQyx6Lmkla3geEBFnQPbMvKT7orejDGAVOAWuJS11F+sFiIgrIDzbknRQFzAGTEt6yhfqB4iIGeBZ0kctQNGXiwBlD6WBLRgBRjsw2oH/swO2H+PNNlv2EEk5iGxfAuOS2jmdgyixWOc6TkX/esBFbNvyUHagbGjRFV6rBX8O8BIGD2BNUhirGl+2s+nqTdJU/jXcBXYaT+1dsPMn5ttAEqffgJj8IcgrcCcp/Nj2qjURNYEcOuAL05bhIfH0S1gAAAAASUVORK5CYII="}}]);