(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6ea82af3"],{"24fd":function(e,t,a){"use strict";var o=a("4876");t["a"]={GetOrgs:function(e,t){Object(o["b"])("/orgs",e,t)},AddOrg:function(e,t){Object(o["d"])("/orgs",e,t)},UpdateOrg:function(e,t){Object(o["e"])("/orgs",e,t)},DeleteOrg:function(e,t){Object(o["a"])("/orgs/"+e,null,t)},GetContrastTree:function(e,t){Object(o["b"])("/contrasttree",e,t)}}},"2a5b":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"app-container layout"},[o("el-form",{ref:"form",staticClass:"s-form",attrs:{rules:e.rules,model:e.formData,"label-suffix":":","label-width":"120px"}},[o("el-form-item",{attrs:{label:"编号",prop:"code"}},[o("el-input",{staticStyle:{width:"30%"},attrs:{size:"small"},model:{value:e.formData.code,callback:function(t){e.$set(e.formData,"code",t)},expression:"formData.code"}})],1),o("el-form-item",{attrs:{label:"姓名",prop:"name"}},[o("el-input",{staticStyle:{width:"30%"},attrs:{size:"small"},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),o("el-form-item",{attrs:{label:"头像",prop:"avatar"}},[o("div",{staticClass:"headPhoto"},[o("div",{staticClass:"headPhoto-ctrl"},[o("img",{attrs:{src:a("d617")},on:{click:e.importAvatar}})]),o("img",{directives:[{name:"show",rawName:"v-show",value:0==e.uploadFileWay,expression:"uploadFileWay == 0"}],staticClass:"headPhoto-mask",staticStyle:{display:"block"},attrs:{src:e._f("fmtAvatar")(e.formData.avatar),width:"100%",height:"100%"}}),o("img",{directives:[{name:"show",rawName:"v-show",value:1==e.uploadFileWay,expression:"uploadFileWay == 1"}],staticClass:"headPhoto-mask",staticStyle:{display:"block"},attrs:{src:e.formData.avatar,width:"100%",height:"100%"}})])]),o("el-form-item",{attrs:{label:"性别",prop:"sex"}},[o("el-radio-group",{model:{value:e.formData.sex,callback:function(t){e.$set(e.formData,"sex",t)},expression:"formData.sex"}},[o("el-radio",{attrs:{label:0}},[e._v("男")]),o("el-radio",{attrs:{label:1}},[e._v("女")])],1)],1),o("el-form-item",{attrs:{label:"所属机构",prop:"orgId"}},[o("treeselect",{staticClass:"g-treeselect",staticStyle:{width:"30%"},attrs:{multiple:!1,options:e.orgData,"disable-branch-nodes":!1,"search-nested":"",placeholder:"请选择"},model:{value:e.formData.orgId,callback:function(t){e.$set(e.formData,"orgId",t)},expression:"formData.orgId"}})],1),o("el-form-item",{attrs:{label:"岗位"}},[o("el-select",{staticStyle:{width:"30%"},attrs:{size:"medium",placeholder:"请选择",clearable:""},model:{value:e.formData.postId,callback:function(t){e.$set(e.formData,"postId",t)},expression:"formData.postId"}},e._l(e.postData,(function(e){return o("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),o("el-form-item",{attrs:{label:"备注"}},[o("el-input",{staticStyle:{width:"30%"},attrs:{type:"textarea",rows:4},model:{value:e.formData.remark,callback:function(t){e.$set(e.formData,"remark",t)},expression:"formData.remark"}})],1),o("el-form-item",[o("div",{staticClass:"dialog-footer"},[o("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.onSubmit}},[e._v("保存")]),o("el-button",{attrs:{size:"small"},on:{click:e.onCancel}},[e._v("取消")])],1)])],1),o("el-dialog",{attrs:{title:"选择头像",visible:e.headPhotoModal,width:"680px"},on:{"update:visible":function(t){e.headPhotoModal=t}}},[o("div",{staticClass:"headPhoto-container"},[o("div",{staticClass:"video-container"},[o("canvas",{attrs:{id:"video-canvas"}})])]),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{size:"small"},on:{click:e.cancelAvatar}},[e._v("取 消")]),o("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.handleCapture}},[e._v("抓 拍")])],1)])],1)},r=[],n=(a("7ec7"),a("87da"),a("149f"),a("c662")),s=a("24fd"),i=a("5892"),l=a("3de1"),c=a("7d66"),u=a.n(c),d=(a("5166"),{data:function(){return{formData:{name:"",code:"",sex:null,orgId:null,postId:null,remark:"",avatar:""},orgData:[],postData:[],headPhotoModal:!1,curAvatarId:null,uploadFileWay:0,fileObj:null,player:null,wsUrl:"ws://127.0.0.1:8089/",rules:{code:[{required:!0,validator:l["a"].verifyPersonCode,trigger:"blur"}],name:[{required:!1,validator:l["a"].verifyPersonName,trigger:"blur"}],avatar:[{required:!0,message:"头像图片不能为空",trigger:"blur"}],sex:[{required:!0,message:"性别不能为空",trigger:"blur"}],orgId:[{required:!0,message:"所属机构不能为空，如改人员不属于任何机构，请选择 '其他'",trigger:"blur"}]}}},computed:{},created:function(){this.getOrgTree(),this.getPostData()},mounted:function(){},methods:{getOrgTree:function(){var e=this;s["a"].GetOrgs(null,(function(t,a){t||(e.orgData=a.data)}))},getPostData:function(){var e=this;i["a"].GetAllPosts(null,(function(t,a){t||(e.postData=a.data)}))},openPhotoModal:function(){var e=this;this.headPhotoModal=!0,this.$nextTick((function(){var t=document.getElementById("video-canvas");t&&(e.player=new JSMpeg.Player(e.wsUrl,{canvas:t}))}))},fileUpload:function(e){var t=document.createElement("input");t.type="file",t.accept="image/gif,image/jpeg,image/jpg,image/png",t.click(),t.onchange=function(a){"function"===typeof e&&e(a.target.files[0]),t=null}},importAvatar:function(){var e=this;e.fileUpload((function(t){var a=new FileReader;a.readAsDataURL(t),a.onload=function(a){e.uploadFileWay=1,e.formData.avatar=this.result,e.fileObj=t}}))},handleCapture:function(){var e=this;this.player&&this.player.stop(),n["a"].Capture(null,(function(t,a){t||(e.formData.avatar="".concat(a.imgUrl),e.uploadFileWay=0,e.headPhotoModal=!1)}))},cancelAvatar:function(){this.curAvatarId=null,this.headPhotoModal=!1,this.player&&this.player.stop()},onSubmit:function(){var e=this;this.$refs["form"].validate((function(t){if(!t)return!1;new Promise((function(t,a){1==e.uploadFileWay?l["a"].uploadAvatar(e.fileObj,{code:e.formData.code}).then((function(e){t(e||null)})):n["a"].GenAvatar({srcUrl:e.formData.avatar,code:e.formData.code},(function(e,a){t(e?null:a.url)}))})).then((function(t){t&&(""==e.formData.name&&(e.formData.name=e.formData.code),n["a"].AddPerson(Object.assign({},e.formData,{avatar:t}),(function(t,a){t||(1==a.status?e.$message.error("人脸注册失败，请重新上传人脸图片！"):(e.$message({message:"保存成功!",type:"success"}),e.setRouter()))})))}))}))},onCancel:function(){this.setRouter()},setRouter:function(){this.$router.push({name:"PersonList"})}},beforeDestroy:function(){this.player&&this.player.destroy()},components:{Treeselect:u.a}}),f=d,p=(a("ea3a"),a("e607")),m=Object(p["a"])(f,o,r,!1,null,"3a1e269f",null);t["default"]=m.exports},"3de1":function(e,t,a){"use strict";var o=a("7b0b"),r=a("33ed"),n=(a("7ec7"),a("3016"),a("4fda"),a("f959"),a("535d"),a("938d"),a("220f"),a("0512"),a("1870"),a("87da"),a("6e9f"),a("f753")),s=a.n(n),i=a("4876"),l=a("23c5"),c=function(e,t){var a=t.code,o=t.oldAvatar,r=void 0===o?null:o,n="http://localhost:7068/api/v1";return new Promise((function(t,o){if(e.size>=1048576)return Object(l["Message"])({message:"图片大小不能超过1M!",type:"error",duration:3e3}),void t(null);var i=new FormData;i.append("code",a),i.append("oldAvatar",r),i.append("file",e),s.a.post(n+"/uploadavatar",i).then((function(e){var a=e.data;0==a.code&&a.data?t(a.data.url):t(null)}),(function(e){Object(l["Message"])({message:"图片上传失败！",type:"error",duration:3e3}),t(null)})).catch((function(e){console.error(e),Object(l["Message"])({message:"图片上传失败！",type:"error",duration:3e3}),t(null)}))}))},u=function(e){var t="http://localhost:7068/api/v1";return new Promise((function(a,o){if(e.size>=10485760)return l["Message"].error({content:"视频大小不能超过10M!",duration:3}),void a(null);var r=new FormData;r.append("file",e),s.a.post(t+"/uploadvideo",r).then((function(e){var t=e.data;0==t.code&&t.data?a(t.data.url):a(null)}),(function(e){l["Message"].error({content:"视频上传失败！",duration:3}),a(null)})).catch((function(e){console.error(e),l["Message"].error({content:"视频上传失败！",duration:3}),a(null)}))}))};function d(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"报表",o=arguments.length>3?arguments[3]:void 0;if(e=e.indexOf("http")>-1?e:window.location.origin+e,e=new URL(e),Object.keys(t).forEach((function(a){return e.searchParams.append(a,t[a])})),a){var r=function(e){var t=document.createElement("a");t.style.display="none",t.download=a,t.href=e,document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(e),o&&o()};fetch(e,{method:"GET",headers:new Headers({"X-Token":""})}).then((function(e){return e.blob()})).then((function(e){var t=window.URL.createObjectURL(e);r(t)}))}else Object(l["Message"])({message:"没有文件名称！（请联系管理员）",type:"error",duration:5e3})}var f=function(e){var t="http://localhost:7068/api/v1";return new Promise((function(a,o){if(e.size>=1048576)return Object(l["Message"])({message:"图片大小不能超过1M!",type:"error",duration:3e3}),void a(null);var r=new FormData;r.append("file",e),s.a.post(t+"/sysconfig/uploadlicensefile",r).then((function(e){var t=e.data;0==t.code?a(!0):a(t.msg)}),(function(e){Object(l["Message"])({message:"授权文件导入失败！",type:"error",duration:3e3}),a(null)})).catch((function(e){console.error(e),Object(l["Message"])({message:"授权文件导入失败！",type:"error",duration:3e3}),a(null)}))}))},p=function(e){return new Promise((function(t,a){var o=e.code;""==o?t("编号不能为空！"):o.length>100&&t("编号的长度不能超过100！");var r=/^[0-9a-zA-Z_]{1,}$/g;r.test(o)||t("编号为数字，字母，下划线的组合！"),Object(i["b"])("/verify",e,(function(e,a){t(e||null==a?null:a)}))}))},m=function(e){return new Promise((function(t,a){var o=e.name;""!=o&&o.length>100?t("姓名长度不能超过100！"):t(null)}))},v=function(){var e=Object(r["a"])(Object(o["a"])().mark((function e(t,a,r){var n;return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,m({name:a});case 2:n=e.sent,null!=n?r(new Error(n)):r();case 4:case"end":return e.stop()}}),e)})));return function(t,a,o){return e.apply(this,arguments)}}(),h=function(){var e=Object(r["a"])(Object(o["a"])().mark((function e(t,a,r){var n;return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,p({code:a});case 2:n=e.sent,null!=n?r(new Error(n)):r();case 4:case"end":return e.stop()}}),e)})));return function(t,a,o){return e.apply(this,arguments)}}();t["a"]={downloadFile:d,uploadAvatar:c,uploadVideo:u,uploadLicenseFile:f,verifyCode:p,verifyName:m,verifyPersonCode:h,verifyPersonName:v}},"4f6a":function(e,t,a){},5892:function(e,t,a){"use strict";var o=a("4876");t["a"]={GetList:function(e,t){Object(o["b"])("/posts",e,t)},GetAllPosts:function(e,t){Object(o["b"])("/allposts",e,t)},GetPostDetail:function(e,t){Object(o["b"])("/posts/"+e,null,t)},AddPost:function(e,t){Object(o["d"])("/posts",e,t)},UpdatePost:function(e,t){Object(o["e"])("/posts",e,t)},UpdatePostEnabled:function(e,t){Object(o["e"])("/postenabled",e,t)},DeletePost:function(e,t){Object(o["a"])("/posts/"+e,null,t)}}},c662:function(e,t,a){"use strict";var o=a("4876");t["a"]={GetList:function(e,t){Object(o["b"])("/persons",e,t)},GetPersonDetail:function(e,t){Object(o["b"])("/persons/"+e,null,t)},AddPerson:function(e,t){Object(o["d"])("/persons",e,t)},UpdatePerson:function(e,t){Object(o["e"])("/persons",e,t)},DeletePerson:function(e,t){Object(o["a"])("/persons/"+e,null,t)},PersonContrast:function(e,t){Object(o["b"])("/contrast",e,t)},Capture:function(e,t){Object(o["b"])("/capture",e,t)},GenAvatar:function(e,t){Object(o["b"])("/copyavatar",e,t)},WriteAvatar:function(e,t){Object(o["d"])("/writeavatar",e,t)}}},d617:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAWBJREFUWEft17EuBFEYxfH/eQAPoNMrFF6ASqUkGkFDRbVqehQShURBSAgqiUJHTyGewSvoJEfu5s5mTXZnZ+6MbLC322T2O7+9X+beb8WQl+rk254APiW9p9ZJBtheAG5i8KKk2xREEiAXnuUmISoD+oQnIyoBcuH7QCsm7wHbKe0oDciFH0natO0QKkm2D4GtqohSgFz4iaT1ENQNiJ+PgY0qiIEA23PAQyx6Lmkla3geEBFnQPbMvKT7orejDGAVOAWuJS11F+sFiIgrIDzbknRQFzAGTEt6yhfqB4iIGeBZ0kctQNGXiwBlD6WBLRgBRjsw2oH/swO2H+PNNlv2EEk5iGxfAuOS2jmdgyixWOc6TkX/esBFbNvyUHagbGjRFV6rBX8O8BIGD2BNUhirGl+2s+nqTdJU/jXcBXYaT+1dsPMn5ttAEqffgJj8IcgrcCcp/Nj2qjURNYEcOuAL05bhIfH0S1gAAAAASUVORK5CYII="},ea3a:function(e,t,a){"use strict";a("4f6a")}}]);